<script>
(async () => {
  const path = window.location.pathname.replace(/^\/+/, '');
  const [group, key] = path.split('/');
  console.log('[URL Path]', path);
  console.log('[Group]', group);
  console.log('[Key]', key);

  if (!group || !key) {
    console.warn('âŒ ç¾¤çµ„æˆ–ä»£ç¢¼æ ¼å¼éŒ¯èª¤');
    return;
  }

  const versionURL = "https://cdn.jsdelivr.net/gh/leo0803/reurl-data@latest/version.json";
  const verKey = `ver_all`;
  console.log('[Version JSON]', versionURL);

  try {
    const versionRes = await fetch(versionURL);
    const versionJson = await versionRes.json();
    const version = versionJson.version;
    console.log('[Version]', version);

    const cachedVer = localStorage.getItem(verKey);
    const needRefresh = cachedVer !== version;
    console.log('[Cached Version]', cachedVer);
    console.log('[Needs Refresh]', needRefresh);

    const dataKey = `data_${group}`;
    let data = {};

    if (!needRefresh && localStorage.getItem(dataKey)) {
      console.log(`[Cache Hit] ä½¿ç”¨å¿«å–è³‡æ–™`);
      data = JSON.parse(localStorage.getItem(dataKey));
    } else {
      const dataURL = `https://cdn.jsdelivr.net/gh/leo0803/reurl-data@latest/${group}.json?v=${version}`;
      console.log('[Fetch Data URL]', dataURL);
      const res = await fetch(dataURL);
      data = await res.json();
      localStorage.setItem(dataKey, JSON.stringify(data));
      localStorage.setItem(verKey, version);
    }

    console.log('[Data]', data);
    const target = data[key];
    console.log('[Target]', target);

    if (target) {
      window.location.href = target;
    } else {
      console.warn('ğŸ” æŸ¥ç„¡å°æ‡‰è½‰å€');
    }
  } catch (err) {
    console.error('ğŸš« è¼‰å…¥è³‡æ–™å¤±æ•—', err);
  }
})();
</script>