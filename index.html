<script>
(async () => {
  const path = window.location.pathname.replace(/^\/+/, '');
  const [group, key] = path.split('/');
  if (!group || !key) {
    window.location.href = "/404";
    return;
  }

  const versionURL = "https://cdn.jsdelivr.net/gh/leo0803/reurl-data@latest/version.json";
  const dataURL = `https://cdn.jsdelivr.net/gh/leo0803/reurl-data@latest/${group}.json`;

  const verKey = `ver_${group}`;
  const dataKey = `data_${group}`;

  try {
    const verRes = await fetch(versionURL);
    const version = (await verRes.json())[group];

    let data;
    if (localStorage.getItem(verKey) === version) {
      data = JSON.parse(localStorage.getItem(dataKey) || '{}');
    } else {
      const dataRes = await fetch(dataURL + '?v=' + version);
      data = await dataRes.json();
      localStorage.setItem(dataKey, JSON.stringify(data));
      localStorage.setItem(verKey, version);
    }

    const target = data[key];
    if (target) {
      window.location.href = target;
    } else {
      window.location.href = "/404.html";
    }
  } catch (err) {
    window.location.href = "/404.html";
  }
})();
</script>
