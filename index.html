<script>
(async () => {
  const path = window.location.pathname.replace(/^\/+/, '');
  const [group, key] = path.split('/');
  if (!group || !key) {
    window.location.href = "/404.html";
    return;
  }

  const versionURL = "https://cdn.jsdelivr.net/gh/leo0803/reurl-data@latest/version.json";
  const verKey = `ver_all`;
  const versionRes = await fetch(versionURL);
  const version = (await versionRes.json()).version;

  const cachedVer = localStorage.getItem(verKey);
  const needRefresh = cachedVer !== version;

  const dataKey = `data_${group}`;
  let data = {};

  if (!needRefresh && localStorage.getItem(dataKey)) {
    data = JSON.parse(localStorage.getItem(dataKey));
  } else {
    const dataURL = `https://cdn.jsdelivr.net/gh/leo0803/reurl-data@latest/${group}.json?v=${version}`;
    try {
      const res = await fetch(dataURL);
      data = await res.json();
      localStorage.setItem(dataKey, JSON.stringify(data));
      localStorage.setItem(verKey, version);
    } catch (err) {
      window.location.href = "/404.html";
      return;
    }
  }

  const target = data[key];
  if (target) {
    window.location.href = target;
  } else {
    window.location.href = "/404.html";
  }
})();
</script>